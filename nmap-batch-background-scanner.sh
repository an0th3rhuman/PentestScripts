#!/bin/bash

filename="$1"
totalips=$(wc -l < "$filename")

echo "usage: ./nmap-batch-scanner.sh <ip-file>"
echo "Total no of IP's available $totalips"
echo "STARTING NMAP"
count=1

## Read the file in batches of 20 lines
for((i=20;i<=$(wc -l < "$filename");i+=20)); do
    head -n "$i" "$filename" | tail -n 20 |
    echo "Executing batch $count"
    count=$(($count+1))

        while IFS= read -r line
        do
          echo "executing the nmap scan for $line"
          ## Launch the command in the background
          nmap $line -p 80 -oA nmap_$line.txt |
            grep "Discovered open port" | awk {'print $6'} |
                awk -F/ {'print $1'} >> total.txt &
        done

    wait
done
