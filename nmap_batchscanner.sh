#!/bin/bash

filename="$1"
batches=$2
totalips=$(wc -l < "$filename")

echo "usage: ./nmap-batch-scanner.sh <ip-file> <no-of-ips-per-batch> "
echo "Total no of IP's available $totalips"
echo "splitting file to $batches per batch"

split -a 1 -l $batches -d --additional-suffix=.txt $filename batch

echo "Total batch created: $(($totalips/$batches))"

batchlist=$(ls -1 batch*)
for batch in $batchlist; do
  echo "Scanning the ips in $batch"
  nmap -Pn -sS -sV -A -p- -iL $batch -oN nmap_$batch.txt
done
